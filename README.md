## Описание приложения 
В данном репозитории представлено стандартное CRUD-приложение, которое моделирует новостной сайт. В нем заданы модели пользователей, новостей и комментариев. Каждый верифицированный пользователь может создавать новости, другие пользователи могут оставлять, редактировать и удалять комментарии. В приложении реализованы миграции моковых данных. 
## Описание моделей 
- **Модель пользователей** 
Каждый пользователь имеет параметры: 
1. **id** - отвечает за id пользователя 
2. **name** - отвечает за имя пользователя
3. **email** - отвечает за электронную почту пользователя
4. **registred_at** - отвечает за дату регистрации пользователя
5. **is_verified_author** - отвечает за то, может ли пользователь создавать новости или нет 
6. **avatar_url** - содержит ссылку на аватар пользователя
7. **news** - связано с моделью News - отвечает за новости, созданные пользователем 
8. **comments** - связано с моделью Comment - отвечает за список комментариев, оставленных пользователем
- **Модель комментариев**
1. **id** - отвечает за id комментария 
2. **text** - отвечает за текст комментария
3. **published_at** - отвечает за дату создания комментария
4. **news_id** - связано с моделью News - отвечает за то, к какой новости оставлен комментарий
5. **author_id** - связано с моделью User - отвечает за то, каким пользователем оставлен комментарий
- **Модель новостей**
Каждая новость имеет параметры: 
1. **id** - отвечает за id новости
2. **title** - отвечает за заголовок новости
3. **content** - json-формат содержания новости
4. **published_at** - отвечает за дату и время создания новости
5. **cover_url** 
6. **author_id** - связано с моделью User - отвечает за id автора, создавшего новость 
7. **author** - связано с моделью User - отвечает за автора, создавшего новость 
8. **comments** - связано с моделью Comment - отвечает за список комментариев, привязанных к новости
## Описание ручек 
- **Пользователи**:
1. Вывести список пользователей:
```
curl -X GET http://127.0.0.1:8000/api/users/list
```
2. Получить информацию о пользователе по id: 
```
curl -X GET http://127.0.0.1:8000/api/users/1
```
3. Создать пользователя: 
```
curl -X POST http://127.0.0.1:8000/api/users/create \
-H "Content-Type: application/json" \
-d '{"name":"test","email":"email@test.com","is_verified_author":"true"}'
```
4. Обновить информацию о пользователе: 
```
curl -X PUT http://127.0.0.1:8000/api/users/1/update \
     -H "Content-Type: application/json" \
     -d '{"name":"Alice Updated","is_verified_author":false,"avatar_url":"https://picsum.photos/200"}'
```
5. Удалить пользователя:
```
curl -X DELETE http://127.0.0.1:8000/api/users/3/delete
```
- **Новости**: 
1. Вывести список новостей:
```
curl -X GET http://127.0.0.1:8000/api/news/list
```
2. Посмотреть новость по id: 
```
curl -X GET http://127.0.0.1:8000/api/news/1
```
3. Создать новость: 
```
curl -X POST http://127.0.0.1:8000/api/news/create \
-H "Content-Type: application/json" \
-d '{"title":"My first news","content":{"body":"Hello world!"},"author_id":4}'
```
>[!prim] Важное примечание!
>Создавать новости могут только **верифицированные** авторы. Запросы выше будет выполнен только если автор имеет true в is_verified_author. Иначе будет получена ошибка: 403 - Only verified authors can create news
4. Изменить новость: 
```
curl -X PUT http://127.0.0.1:8000/api/news/1/update \
     -H "Content-Type: application/json" \
     -d '{"title":"Updated title","content":{"body":"Updated text"},"cover_url":null}'
```
5. Удалить новость: 
```
curl -X DELETE http://127.0.0.1:8000/api/news/2/delete
```
- **Комментарии**: 
1. Посмотреть список комментариев к конкретной новости: 
```
curl -X GET http://127.0.0.1:8000/api/news/1/comments
```
2. Посмотреть конкретный комментарий по id: 
```
curl -X GET http://127.0.0.1:8000/api/comments/1
```
3. Изменить конкретный комментарий по id: 
```
curl -X PUT http://127.0.0.1:8000/api/comments/1/update \
     -H "Content-Type: application/json" \
     -d '{"text":"Edited comment"}'
```
4. Удалить комментарий: 
```
curl -X DELETE http://127.0.0.1:8000/api/comments/1/delete
```
5. Создать комментарий:
```
curl -X POST http://127.0.0.1:8000/api/news/1/comments/create \
     -H "Content-Type: application/json" \
     -d '{"text":"Great article!","author_id":2}'
```
## Инструкция по локальному запуску приложения
Для начала необходимо **клонировать** репозиторий: 
```
git clone https://github.com/hep2014/standardCRUD.git
cd standardCRUD
```
Далее необходимо создать **виртуальное окружение**:
```
python3 -m venv .venv
source .venv/bin/activate
```
После этого необходимо установить **зависимости**: 
```
pip install fastapi sqlalchemy alembic uvicorn psycopg2-binary
```
Далее необходимо настроить БД. В проекте используется postgresql, поэтому она должна присутствовать на устройстве. Далее необходимо **отредактировать** файл **app/db/db.py**:
```
DATABASE_URL = "postgresql+psycopg2://ИМЯ_ПОЛЬЗОВАТЕЛЯ:ПАРОЛЬ@localhost:5432/ilya_news_db"
```
После этого необходимо создать базу данных локально: 
```
sudo -u ИМЯ_ПОЛЬЗОВАТЕЛЯ psql -c "CREATE DATABASE ilya_news_db;"
```
Далее необходимо применить миграции: 
```
alembic upgrade head
```
И запустить FastAPI: 
```
uvicorn app.main:app --reload
```

После запуска приложение доступно по адресу:
- API-документация (Swagger): http://127.0.0.1:8000/docs
- Альтернатива ReDoc: http://127.0.0.1:8000/redoc
---
Проект выполнен на FastAPI + SQLAlchemy + Alembic.  
Автор: Илья Матвеев (hep2014)
